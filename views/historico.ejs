<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= titulo %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/historico.css">
</head>

<body>
    <!-- Barra de Navega√ß√£o -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="/principal" class="nav-brand">FinancerPro</a>
            
            <button class="nav-toggle" id="navToggle">
                <span class="nav-icon">‚ò∞</span>
            </button>

            <ul class="nav-menu" id="navMenu">
                <li class="nav-item">
                    <a href="/principal" class="nav-link <%= currentPage === '/principal' ? 'active' : '' %>">
                        <span class="nav-icon">üìä</span>
                        Dashboard
                        <span class="nav-indicator"></span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/transacoes" class="nav-link <%= currentPage === '/transacoes' ? 'active' : '' %>">
                        <span class="nav-icon">üí∏</span>
                        Adicionar Transa√ß√£o
                        <span class="nav-indicator"></span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/historico" class="nav-link <%= currentPage === '/historico' ? 'active' : '' %>">
                        <span class="nav-icon">üìà</span>
                        Hist√≥rico
                        <span class="nav-indicator"></span>
                    </a>
                </li>
            </ul>

            <div class="user-menu">
                <div class="user-avatar">JS</div>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1><%= titulo %></h1>
            <p class="page-subtitle">Visualize todo o hist√≥rico de transa√ß√µes</p>
        </div>
        
        <!-- Estat√≠sticas R√°pidas -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üì•</div>
                <div class="stat-info">
                    <div class="stat-label">Entradas</div>
                    <div class="stat-value">R$ <%= totais.entradas %></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üì§</div>
                <div class="stat-info">
                    <div class="stat-label">Sa√≠das</div>
                    <div class="stat-value">R$ <%= totais.saidas %></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚öñÔ∏è</div>
                <div class="stat-info">
                    <div class="stat-label">Saldo</div>
                    <div class="stat-value">R$ <%= totais.saldo %></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìã</div>
                <div class="stat-info">
                    <div class="stat-label">Total Transa√ß√µes</div>
                    <div class="stat-value"><%= transacoes.length %></div>
                </div>
            </div>
        </div>

        <!-- Filtros -->
        <div class="filters-container">
            <div class="filters-header">
                <h3>Filtros</h3>
                <button class="btn-clear-filters" id="clearFilters">
                    <span>üîÑ Limpar Filtros</span>
                </button>
            </div>
            <div class="filters-grid">
                <div class="filter-group">
                    <label for="filterTipo">Tipo</label>
                    <select id="filterTipo" class="filter-select">
                        <option value="">Todos</option>
                        <option value="Entrada">Entrada</option>
                        <option value="Sa√≠da">Sa√≠da</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterCategoria">Categoria</label>
                    <select id="filterCategoria" class="filter-select">
                        <option value="">Todas</option>
                        <option value="Receita">Receita</option>
                        <option value="Moradia">Moradia</option>
                        <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                        <option value="Transporte">Transporte</option>
                        <option value="Sa√∫de">Sa√∫de</option>
                        <option value="Educa√ß√£o">Educa√ß√£o</option>
                        <option value="Lazer">Lazer</option>
                        <option value="Outros">Outros</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterData">Per√≠odo</label>
                    <select id="filterData" class="filter-select">
                        <option value="">Todos</option>
                        <option value="hoje">Hoje</option>
                        <option value="semana">Esta Semana</option>
                        <option value="mes">Este M√™s</option>
                        <option value="trimestre">Este Trimestre</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterOrdenar">Ordenar por</label>
                    <select id="filterOrdenar" class="filter-select">
                        <option value="data-desc">Data (Mais Recente)</option>
                        <option value="data-asc">Data (Mais Antiga)</option>
                        <option value="valor-desc">Valor (Maior)</option>
                        <option value="valor-asc">Valor (Menor)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Tabela de Hist√≥rico -->
        <div class="table-section">
            <div class="section-header">
                <h3>Hist√≥rico Completo</h3>
                <div class="section-actions">
                    <span class="transactions-count" id="transactionsCount">
                        <%= transacoes.length %> transa√ß√µes encontradas
                    </span>
                    <button class="btn-export" id="btnExport">
                        <span>üìä Exportar</span>
                    </button>
                </div>
            </div>
            
            <% if (transacoes && transacoes.length > 0) { %>
                <div class="table-container">
                    <table id="transactionsTable">
                        <thead>
                            <tr>
                                <th data-sort="data">Data üìÖ</th>
                                <th data-sort="descricao">Descri√ß√£o</th>
                                <th data-sort="categoria">Categoria</th>
                                <th data-sort="tipo">Tipo</th>
                                <th data-sort="valor">Valor R$</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% transacoes.forEach(function(transacao) { %>
                                <tr class="transaction-row" 
                                    data-tipo="<%= transacao.tipo %>" 
                                    data-categoria="<%= transacao.categoria %>"
                                    data-data="<%= transacao.data %>"
                                    data-valor="<%= transacao.valor %>">
                                    <td class="transaction-date">
                                        <div class="date-display">
                                            <span class="date-day"><%= new Date(transacao.data).getDate() %></span>
                                            <span class="date-month"><%= new Date(transacao.data).toLocaleDateString('pt-BR', { month: 'short' }) %></span>
                                        </div>
                                    </td>
                                    <td class="transaction-desc">
                                        <div class="desc-text"><%= transacao.descricao %></div>
                                        <% if (transacao.descricao.length > 30) { %>
                                            <div class="desc-tooltip"><%= transacao.descricao %></div>
                                        <% } %>
                                    </td>
                                    <td class="transaction-category">
                                        <span class="category-badge category-<%= transacao.categoria.toLowerCase() %>">
                                            <%= transacao.categoria %>
                                        </span>
                                    </td>
                                    <td class="transaction-type">
                                        <span class="type-badge type-<%= transacao.tipo.toLowerCase() %>">
                                            <span class="type-icon">
                                                <%= transacao.tipo === 'Entrada' ? '‚¨ÜÔ∏è' : '‚¨áÔ∏è' %>
                                            </span>
                                            <%= transacao.tipo %>
                                        </span>
                                    </td>
                                    <td class="transaction-value">
                                        <span class="value-amount <%= transacao.tipo.toLowerCase() %>">
                                            R$ <%= transacao.valor.toFixed(2) %>
                                        </span>
                                    </td>
                                    <td class="transaction-actions">
                                        <div class="actions-container">
                                            <button class="btn-action btn-edit" title="Editar">
                                                <span>‚úèÔ∏è</span>
                                            </button>
                                            <a href="/excluir/<%= transacao.id %>" 
                                               class="btn-action btn-delete" 
                                               title="Excluir"
                                               onclick="return confirm('Tem certeza que deseja excluir esta transa√ß√£o?')">
                                                <span>üóëÔ∏è</span>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            <% } else { %>
                <div class="empty-state">
                    <div class="empty-icon">üìù</div>
                    <h3>Nenhuma transa√ß√£o encontrada</h3>
                    <p>Comece adicionando sua primeira transa√ß√£o ao sistema</p>
                    <a href="/transacoes" class="btn-primary">
                        <span>‚ûï Adicionar Primeira Transa√ß√£o</span>
                    </a>
                </div>
            <% } %>
        </div>

        <!-- Resumo por Categoria -->
        <% if (transacoes && transacoes.length > 0) { %>
            <div class="categories-section">
                <h3>Resumo por Categoria</h3>
                <div class="categories-grid">
                    <% 
                        const categorias = {};
                        transacoes.forEach(transacao => {
                            if (!categorias[transacao.categoria]) {
                                categorias[transacao.categoria] = { entradas: 0, saidas: 0 };
                            }
                            if (transacao.tipo === 'Entrada') {
                                categorias[transacao.categoria].entradas += transacao.valor;
                            } else {
                                categorias[transacao.categoria].saidas += transacao.valor;
                            }
                        });
                    %>
                    <% Object.keys(categorias).forEach(categoria => { %>
                        <div class="category-card">
                            <div class="category-header">
                                <h4><%= categoria %></h4>
                                <span class="category-total">
                                    R$ <%= (categorias[categoria].entradas - categorias[categoria].saidas).toFixed(2) %>
                                </span>
                            </div>
                            <div class="category-stats">
                                <div class="category-stat">
                                    <span class="stat-label">Entradas:</span>
                                    <span class="stat-value positive">R$ <%= categorias[categoria].entradas.toFixed(2) %></span>
                                </div>
                                <div class="category-stat">
                                    <span class="stat-label">Sa√≠das:</span>
                                    <span class="stat-value negative">R$ <%= categorias[categoria].saidas.toFixed(2) %></span>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
        <% } %>
    </div>

    <script src="/js/historico.js"></script>
</body>
</html>